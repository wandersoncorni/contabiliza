/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./resources/js/services-plan.js":
/*!***************************************!*\
  !*** ./resources/js/services-plan.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("/* provided dependency */ var $ = __webpack_require__(/*! jquery */ \"jquery\");\n/**\r\n * Scripts para gerenciar os planos de serviço\r\n */\n\n\n$(document).ready(function () {\n  const serviceListSelected = [];\n  let plansData = [];\n  $('#tb-categories, #tb-services').DataTable({\n    columnDefs: [{\n      \"orderable\": false,\n      \"targets\": [3]\n    } // Desabilita ordenação na coluna de ações\n    ],\n    order: [[0, \"asc\"]]\n  });\n  // Inicializa o DataTable\n  $('#tb-plans').DataTable({\n    ajax: function (data, callback) {\n      fetch('/api/v1/planos-servicos', {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include'\n      }).then(async response => {\n        const resp = {\n          data: []\n        };\n        if (response.ok) {\n          const data = await response.json();\n          const list = [];\n          plansData = data;\n          data.forEach(plan => {\n            const pid = list.length;\n            if (!list.find(plano => plano.id == plan.id)) {\n              list.push({\n                id: plan.id,\n                nome: plan.nome,\n                categorias: [],\n                servicos: []\n              });\n            }\n            plan.categorias_servicos.forEach(cs => {\n              if (!list[pid].categorias.find(cat => cat.id == cs.categoria.id)) {\n                list[pid].categorias.push({\n                  id: cs.categoria.id,\n                  nome: cs.categoria.nome\n                });\n              }\n              if (!list[pid].servicos.find(serv => serv.id == cs.servico.id)) {\n                list[pid].servicos.push({\n                  id: cs.servico.id,\n                  nome: cs.servico.nome,\n                  categoria_id: cs.categoria.id\n                });\n              }\n            });\n          });\n          resp.data = list;\n        }\n        callback(resp);\n      });\n    },\n    columns: [{\n      \"data\": \"nome\"\n    }, {\n      \"data\": data => {\n        const list = $('<ul />', {\n          class: 'list-group'\n        });\n        data.categorias.forEach(cat => {\n          list.append($('<li />', {\n            class: 'list-group-item'\n          }).html(cat.nome).append([$('<button />', {\n            type: 'button',\n            class: 'btn btn-xs btn-transparent text-info ms-2',\n            'data-plano_id': data.id,\n            'data-categoria_id': cat.id\n          }).html($('<i />', {\n            class: 'heroicon heroicon-pencil-square'\n          })), $('<button />', {\n            type: 'button',\n            class: 'btn btn-xs btn-transparent text-danger ms-2',\n            'data-plano_id': data.id,\n            'data-categoria_id': cat.id,\n            'data-action': 'delete_category'\n          }).html($('<i />', {\n            class: 'heroicon heroicon-trash'\n          }))]));\n        });\n        return list.prop('outerHTML');\n      }\n    }, {\n      \"data\": data => {\n        const list = $('<ul />', {\n          class: 'list-group'\n        });\n        data.servicos.forEach(srv => {\n          list.append($('<li />', {\n            class: 'list-group-item'\n          }).html(srv.nome).append([$('<button />', {\n            type: 'button',\n            class: 'btn btn-xs btn-transparent text-info ms-2',\n            'data-plano_id': data.id,\n            'data-categoria_id': srv.categoria_id,\n            'data-servico_id': srv.id\n          }).html($('<i />', {\n            class: 'heroicon heroicon-pencil-square'\n          })), $('<button />', {\n            type: 'button',\n            class: 'btn btn-xs btn-transparent text-danger ms-2',\n            'data-plano_id': data.id,\n            'data-categoria_id': srv.categoria_id,\n            'data-servico_id': srv.id,\n            'data-action': 'delete_service'\n          }).html($('<i />', {\n            class: 'heroicon heroicon-trash'\n          }))]));\n        });\n        return list.prop('outerHTML');\n      }\n    }, {\n      \"data\": data => {\n        return $('<button />', {\n          type: 'button',\n          class: 'btn btn-xs btn-transparent text-danger',\n          'data-plano_id': data.id,\n          'data-action': 'delete_plan'\n        }).html($('<i />', {\n          class: 'heroicon heroicon-trash'\n        })).prop('outerHTML');\n      }\n    }],\n    columnDefs: [{\n      \"orderable\": false,\n      \"targets\": [3]\n    } // Desabilita ordenação na coluna de ações\n    ],\n    order: [[0, \"asc\"]]\n  });\n  // Eventos para o DataTable de planos\n  $('#app-content #tb-plans').on('click', 'button', function (e) {\n    e.preventDefault();\n    let target = 'plano';\n    let url = 'api/v1/plano-servico/' + $(this).data('plano_id');\n    if ($(this).data('action') == 'delete_category') {\n      target = 'categoria';\n      url = 'api/v1/categoria-plano/' + $(this).data('plano_id') + '/' + $(this).data('categoria_id');\n    } else if ($(this).data('action') == 'delete_service') {\n      target = 'serviço';\n      url = 'api/v1/servico-plano/' + $(this).data('plano_id') + '/' + $(this).data('categoria_id') + '/' + $(this).data('servico_id');\n    }\n    if (['delete_plan', 'delete_category', 'delete_service'].includes($(this).data('action'))) {\n      Swal.fire({\n        title: `Exclusão de ${target}`,\n        text: \"Voce não poderá reverter isso!\",\n        icon: 'warning',\n        showCancelButton: true,\n        confirmButtonColor: '#3085d6',\n        cancelButtonColor: '#d33',\n        confirmButtonText: 'Sim, excluir!'\n      }).then(result => {\n        if (result.isConfirmed) {\n          fetch(url, {\n            method: 'DELETE',\n            headers: {\n              'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content'),\n              'X-Requested-With': 'XMLHttpRequest',\n              'Accept': 'application/json'\n            },\n            credentials: 'include'\n          }).then(async response => {\n            const data = await response.json();\n            if (response.ok) {\n              const plansTable = $('#tb-plans').DataTable();\n              plansTable.ajax.reload();\n            } else {\n              Swal.fire(`Erro ao excluir ${target}:`, data.message, 'error');\n            }\n          }).catch(error => console.error(`Erro ao excluir ${target}:`, error));\n        }\n      });\n      return;\n    }\n    const plano = plansData.find(plan => plan.id == $(this).data('plano_id'));\n    loadPlanForm(plano, $(this).data('categoria_id'));\n  });\n  $('#app-content #modal-form-plan').on('show.bs.modal', function (e) {\n    if ($('#lista-categorias option').length <= 1) {\n      fetch('/api/v1/categorias-servicos').then(response => response.json()).then(data => {\n        let categorias = '';\n        data.forEach(categoria => {\n          categorias += `<option value=\"${categoria.id}\">${categoria.nome}</option>`;\n        });\n        $('#lista-categorias').append(categorias);\n      });\n    }\n    if (!$('#lista-servicos option').length) {\n      fetch('/api/v1/servicos').then(response => response.json()).then(data => {\n        let servicos = '';\n        data.forEach(servico => {\n          servicos += `<option class=\"bg-white\" value=\"${servico.id}\">${servico.nome}</option>`;\n        });\n        $('#lista-servicos').html(servicos).prop('size', $('#lista-servicos option').length);\n      });\n    }\n    if ($('#lista-planos option').length <= 1) {\n      loadPlansList();\n    }\n    $('#form-plan')[0].reset();\n    optionReset();\n  });\n  // Eventos para o select de categorias\n  $('#lista-servicos').click(function (e) {\n    e.target.innerHTML = e.target.innerHTML.replace('✔', '');\n    if (serviceListSelected.includes(e.target.value)) {\n      serviceListSelected.splice(serviceListSelected.indexOf(e.target.value), 1);\n      e.target.classList.remove('bg-black');\n      e.target.classList.remove('text-white');\n    } else {\n      serviceListSelected.push(e.target.value);\n      e.target.innerHTML = `&#x2714; ${e.target.innerHTML}`;\n      e.target.classList.add('bg-black');\n      e.target.classList.add('text-white');\n    }\n    $('#lista-servicos').val(serviceListSelected);\n  });\n  // Carrega dados da aba\n  $('#app-content #nav-tab a').click(function () {\n    const navtab = $(this).prop('id');\n    if (navtab == 'nav-plan-tab') {\n      loadPlanosServicosTable();\n    }\n  });\n  // Salva um plano de servicos\n  $('#form-service-plan').submit(function (e) {\n    e.preventDefault();\n    if ($('[name=\"id\"]').val() == 0) {\n      salvarPlanoServico();\n      return;\n    }\n    editarPlanoServico(plansData.find(plano => plano.id == $(this).data('id')));\n  });\n  // Edita um plano de servicos\n  $('#app-content').on('click', '#tb-services-plans button', function () {\n    carregarFormPlanoServico(plansData.find(plano => plano.id == $(this).data('id')));\n  });\n});\nfunction getButtons(id, url) {\n  return $('<div />').append([$('<button />', {\n    class: 'btn btn-xs d-plex me-2 btn-transparent text-info',\n    'data-id': id\n  }).append($('<i />', {\n    class: 'heroicon heroicon-pencil-square'\n  })), $('<button />', {\n    class: 'btn btn-xs d-plex btn-transparent text-danger',\n    'data-id': id\n  }).append($('<i />', {\n    class: 'heroicon heroicon-trash'\n  }))]).prop('innerHTML');\n}\nfunction loadPlanForm(plano, categoria_id) {\n  let leep = 0;\n  $('#modal-form-plan').modal('show');\n  const loader = setInterval(() => {\n    if ($('#modal-form-plan [name=\"plano_servico_id\"]').length > 0) {\n      clearInterval(loader);\n      $('#modal-form-plan [name=\"plano_servico_id\"]').val(plano.id);\n      $('#modal-form-plan [name=\"categoria_servico_id\"]').val(categoria_id);\n      const servicos = [];\n      plano.categorias_servicos.forEach(cs => {\n        if (cs.categoria.id != categoria_id) return;\n        servicos.push(cs.servico.id);\n      });\n      $('#modal-form-plan [name=\"servico_id\"]').val(servicos);\n      setOptionSelected();\n    }\n  }, 500);\n}\nfunction optionReset() {\n  $('#form-plan [name=\"servico_id\"] option').each(function () {\n    $(this).prop('selected', false);\n    $(this).text($(this).text().replace('✔', ''));\n    $(this).removeClass('bg-black');\n    $(this).removeClass('text-white');\n  });\n}\nfunction setOptionSelected() {\n  $('#form-plan [name=\"servico_id\"] option:selected').each(function () {\n    $(this).html('&#x2714;' + $(this).text());\n    $(this).addClass('bg-black');\n    $(this).addClass('text-white');\n  });\n}\n// Carrega a lista do select para planos de servicos\nfunction loadPlansList() {\n  fetch('/api/v1/planos-servicos').then(response => response.json()).then(data => {\n    let planos = '';\n    data.forEach(plano => {\n      planos += `<option value=\"${plano.id}\">${plano.nome}</option>`;\n    });\n    $('#lista-planos').append(planos);\n  });\n}\n// Carrega a tabela de planos de servicos\nfunction loadPlanosServicosTable() {\n  if ($.fn.dataTable.isDataTable('#tb-services-plans')) {\n    $('#tb-services-plans').DataTable().ajax.reload();\n    return;\n  }\n  $('#tb-services-plans').DataTable({\n    ajax: (data, callback) => fetch('/api/v1/planos-servicos').then(async response => {\n      if (!response.ok) {\n        callback({\n          data: []\n        });\n        return;\n      }\n      const data = await response.json();\n      let planos = '';\n      data.forEach(plano => {\n        planos += `<tr>\n                        <td>${plano.nome}</td>\n                        <td>${plano.descricao}</td>\n                        <td>${curencyFormat(plano.valor_mensal)}</td>\n                        <td>${curencyFormat(plano.valor_anual)}</td>\n                        <td>${plano.ativo ? '<span class=\"text-success\">Ativo</span>' : '<span class=\"text-danger\">Inativo</span>'}</td>\n                        <td>${getButtons(plano.id, '/plano-servico')}</td>\n                    </tr>`;\n      });\n      $('#tb-services-plans tbody').html(planos);\n    }),\n    columnDefs: [{\n      \"orderable\": false,\n      \"targets\": [2, 3, 4]\n    } // Desabilita ordenação na coluna de ações\n    ],\n    order: [[0, \"asc\"]]\n  });\n  formatCurrencyValue();\n}\nfunction curencyFormat(value) {\n  return new Intl.NumberFormat('pt-BR', {\n    style: 'currency',\n    currency: 'BRL'\n  }).format(value);\n}\n/**\r\n * Formata o valor do campo currency\r\n */\nfunction formatCurrencyValue() {\n  $('.currency').on('input', function () {\n    let valor = $(this).val();\n    valor = valor.replace(/\\D/g, '');\n    valor = (Number(valor) / 100).toFixed(2);\n    $(this).val(new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(valor));\n  });\n}\n/**\r\n * Sanitiza o valor dos campos com a classe \"currency\"\r\n * @param {string} field \r\n * @returns \r\n */\nfunction clearCurrencyValue(field) {\n  return $(`#${field}`).val().replace(/[^\\d,]/g, '').replace(/\\./g, '').replace(',', '.');\n}\n/**\r\n * Salva um plano\r\n * @param {object} form \r\n */\nfunction salvarPlanoServico() {\n  const formData = new FormData(document.querySelector('#form-service-plan'));\n  formData.set('valor_mensal', clearCurrencyValue('valor_mensal'));\n  formData.set('valor_anual', clearCurrencyValue('valor_anual'));\n  fetch('/api/v1/plano-servico', {\n    method: 'POST',\n    headers: {\n      'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content'),\n      'X-Requested-With': 'XMLHttpRequest',\n      'Accept': 'application/json'\n    },\n    credentials: 'include',\n    body: formData\n  }).then(async response => {\n    const data = await response.json();\n    if (response.ok) {\n      const plansTable = $('#tb-services-plans').DataTable();\n      plansTable.ajax.reload();\n      loadPlanosServicosTable();\n      loadPlansList();\n    } else {\n      Swal.fire(`Erro ao salvar o plano:`, data.message, 'error');\n    }\n  }).catch(error => console.error(`Erro ao salvar o plano:`, error));\n}\n/**\r\n * Carrega o form com os dados do plano\r\n * @param {object} data \r\n */\nfunction carregarFormPlanoServico(data) {\n  Object.keys(data).forEach(campo => {\n    if (['valor_mensal', 'valor_anual'].includes(campo)) {\n      $(`[name=\"${campo}\"]`).val(data[campo]).trigger('input');\n      return;\n    }\n    $(`[name=\"${campo}\"]`).val(data[campo]);\n  });\n}\n/**\r\n * Exclui um plano\r\n * @param {object} data \r\n */\nfunction editarPlanoServico(data = []) {\n  const formData = new FormData(document.querySelector('#form-service-plan'));\n  const dadosPlano = data.find(el => el.id = formData.get('id'));\n  formData.forEach((value, field) => {\n    console.log(value, $(`[name=\"${field}\"]`).val());\n    if (value == $(`[name=\"${field}\"]`).val()) {\n      formData.delete(field);\n    }\n  });\n  console.log(formData);\n  // formData.set('valor_mensal', clearCurrencyValue('valor_mensal'));\n  // formData.set('valor_anual', clearCurrencyValue('valor_anual'));\n}\n\n//# sourceURL=webpack://access-control/./resources/js/services-plan.js?");

/***/ }),

/***/ "jquery":
/*!*************************!*\
  !*** external "jQuery" ***!
  \*************************/
/***/ ((module) => {

module.exports = jQuery;

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./resources/js/services-plan.js");
/******/ 	
/******/ })()
;